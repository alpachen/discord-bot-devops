name: ğŸ¤– Discord Bot CI/CD Pipeline

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  code-quality:
    name: âœ… ç¨‹å¼ç¢¼å“è³ªæª¢æŸ¥
    runs-on: ubuntu-latest
    
    steps:
    # åŸæœ‰çš„æ­¥é©Ÿï¼ˆæª¢æŸ¥ç¨‹å¼ç¢¼ã€å®‰è£ä¾è³´ç­‰ï¼‰...
    - name: ğŸ“¦ ç²å–ç¨‹å¼ç¢¼
      uses: actions/checkout@v4
      
    - name: ğŸ è¨­å®š Python 3.10
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: ğŸ“¦ å®‰è£ä¾è³´å¥—ä»¶
      run: pip install discord.py python-dotenv
      
    - name: ğŸ” Python èªæ³•æª¢æŸ¥
      run: python -m py_compile bot.py
      
    - name: ğŸ§ª æ¨¡çµ„å°å…¥æ¸¬è©¦
      run: python -c "import bot; print('âœ… Bot æ¨¡çµ„å°å…¥æˆåŠŸ')"
    
    # ğŸ”¥ æ–°å¢ï¼šDiscord Webhook é€šçŸ¥æ­¥é©Ÿ
    - name: ğŸ“¢ ç™¼é€ Discord é€šçŸ¥
      if: always()  # ç„¡è«–æˆåŠŸå¤±æ•—éƒ½ç™¼é€
      run: |
        # åˆ¤æ–·åŸ·è¡Œç‹€æ…‹ä¸¦ç™¼é€ç›¸æ‡‰è¨Šæ¯
        if [ "${{ job.status }}" = "success" ]; then
          MSG='{"content": "ğŸ‰ CI/CD æˆåŠŸï¼\nâœ… æ‰€æœ‰æ¸¬è©¦é€šé\nğŸ‘¤ ç”±: ${{ github.actor }}\nğŸ”— æäº¤: ${{ github.sha }}"}'
        else
          MSG='{"content": "âŒ CI/CD å¤±æ•—ï¼\nâš ï¸ è«‹æª¢æŸ¥éŒ¯èª¤\nğŸ‘¤ ç”±: ${{ github.actor }}\nğŸ”— æäº¤: ${{ github.sha }}"}'
        fi
        
        curl -X POST \
          -H "Content-Type: application/json" \
          -d "$MSG" \
          "${{ secrets.DISCORD_WEBHOOK_URL }}"